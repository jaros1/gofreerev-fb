<!DOCTYPE html>
<html>
<head>
  <title><%= title %></title>
  <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track' => true %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
  <script src="/javascripts/my.js"></script>
  <%= csrf_meta_tags %>
  <script>
  </script>
</head>
<body>
<% if  session[:user_id] and @user -%>
    <!-- show page header for logged in users -->
    <%# Hidden form to update currency => post to /users/:id/ => return to this page after currency has been changed -%>
    <div id="update_currency_div" style="display:none">
      <%= form_for @user, :class => 'update_currency_form' do |f| %>
          <%= hidden_field_tag :return_to, @request_fullpath %>
          <%= f.text_field :new_currency %>
      <% end %>
    </div>
    <% if ajax_tasks? -%>
        <%# Hidden form for post login processing (for example downloading profile image -%>
        <div id="ajax_tasks_div" style="display:none">
          <%= form_tag url_for(:controller => :util, :action => :do_ajax_tasks), :remote => true, :id => 'ajax_tasks_form' do %>
              <%= hidden_field_tag :timezone, "" %>
          <% end %>
        </div>
    <% end -%>
    <!-- page header -->
    <%= render :partial => 'layouts/page_header' %>
    <hr/>
<% end -%>
<!-- todo: better flash/error handling -->
<% if flash[:notice] -%>
    <br/>

    <div id="notification"><%= h flash[:notice] %></div>
    <br/>
<% end -%>
<table id="ajax_tasks_errors"></table>
<!-- the page -->
<%= yield %>
<!-- page footer -->
<%= render :partial => 'layouts/page_footer/page_footer' -%>
<% if ajax_tasks? -%>
    <%# trigger hidden form for some ajax processing - for example downloading profile image from login provider -%>
    <script>
        document.getElementById("timezone").value = (new Date().getTimezoneOffset()) / 60.0 ;
        $('#ajax_tasks_form').trigger('submit.rails');
    </script>
<% end -%>
</body>
</html>
<% ExchangeRate.fetch_exchange_rates -%>