<!DOCTYPE html>
<html>
<head>
  <title><%= title %></title>
  <%= stylesheet_link_tag 'normalize', media: 'all', 'data-turbolinks-track' => true %>
  <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track' => true %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
  <script src="/javascripts/my.js"></script>
  <%= csrf_meta_tags %>
  <meta name="viewport" content="width=device-width,initial-scale=1.0, user-scalable=no">
  <script>
  </script>
</head>
<body onload="{add_user_currency_new_event()}">
<div id="wrapper" style="width: 100%;">
  <header>
    <% if @cookie_note -%>
      <div id="cookie_note" style="width: 100%"><%= t '.cookie_note_text', :appname => APP_NAME %> <%= button_tag 'Ok', :onclick => "{document.getElementById('cookie_note').style.display = 'none'}" %><hr></div>
    <% end -%>
    <% if  session[:user_id] and @user -%>
        <!-- show page header for logged in users -->
        <%# Hidden form to update currency => post to /users/:id/ => return to this page after currency has been changed -%>
        <div id="update_currency_div" style="display:none">
          <%= form_for @user, :class => 'update_currency_form' do |f| %>
              <%= hidden_field_tag :return_to, @request_fullpath %>
              <%= f.text_field :new_currency %>
          <% end %>
        </div>
        <% if ajax_tasks? -%>
            <%# Hidden form for post login processing (for example downloading profile image -%>
            <div id="ajax_tasks_div" style="display:none">
              <%= form_tag url_for(:controller => :util, :action => :do_ajax_tasks), :remote => true, :id => 'ajax_tasks_form' do %>
                  <%= hidden_field_tag :timezone, "" %>
              <% end %>
            </div>
        <% end -%>
        <!-- page header -->
        <%= render :partial => 'layouts/page_header' %>
        <div style="width: 100%"><hr></div>
    <% end -%>
    <!-- todo: better flash/error handling -->
    <% if flash[:notice] -%>
        <br/>

        <div id="notification"><%= h flash[:notice] %></div>
        <br/>
    <% end -%>
    <table id="ajax_tasks_errors"></table>
  </header>
  <!-- the page -->
  <%= yield %>
  <footer>
    <%= render :partial => 'layouts/page_footer/page_footer' -%>
    <% if ajax_tasks? -%>
        <%# post response ajax processing - for example download profile image and friend list from login provider -%>
        <script>
            document.getElementById("timezone").value = (new Date().getTimezoneOffset()) / 60.0;
            window.setTimeout(function(){$('#ajax_tasks_form').trigger('submit.rails');}, 1000);
        </script>
    <% end -%>
  </footer>
</div>
<% if debug_ajax? -%>
    <div id="ajax_debug_log" style="width: 100%">
    </div>
<% end -%>
</body>
</html>